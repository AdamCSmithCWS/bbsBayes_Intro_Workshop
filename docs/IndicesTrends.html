<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Estimating Annual Indices and Trends | A Quick Introduction to bbsBayes</title>
  <meta name="description" content="This is a document to support a ~2hr workshop." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Estimating Annual Indices and Trends | A Quick Introduction to bbsBayes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a document to support a ~2hr workshop." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Estimating Annual Indices and Trends | A Quick Introduction to bbsBayes" />
  
  <meta name="twitter:description" content="This is a document to support a ~2hr workshop." />
  

<meta name="author" content="Adam C. Smith, and Brandon P.M. Edwards" />


<meta name="date" content="2021-08-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ModelRun.html"/>
<link rel="next" href="GraphMap.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Quick Introduction to bbsBayes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Customized BBS trends, trajectories, graphs, and maps using the bbsBayes R-package, an Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#what-is-the-workshop-about"><i class="fa fa-check"></i><b>1.1</b> What is the workshop about?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#intended-audience"><i class="fa fa-check"></i><b>1.2</b> Intended Audience</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#what-we-hope-you-will-learn-here"><i class="fa fa-check"></i><b>1.3</b> What we hope you will learn here</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Intro.html"><a href="Intro.html"><i class="fa fa-check"></i><b>2</b> Preparation and Installation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Intro.html"><a href="Intro.html#pre-workshop-preparation"><i class="fa fa-check"></i><b>2.1</b> Pre-Workshop preparation</a></li>
<li class="chapter" data-level="2.2" data-path="Intro.html"><a href="Intro.html#installation"><i class="fa fa-check"></i><b>2.2</b> Installation</a></li>
<li class="chapter" data-level="2.3" data-path="Intro.html"><a href="Intro.html#data-retrieval"><i class="fa fa-check"></i><b>2.3</b> Data Retrieval</a></li>
<li class="chapter" data-level="2.4" data-path="Intro.html"><a href="Intro.html#install-jags"><i class="fa fa-check"></i><b>2.4</b> Install JAGS</a></li>
<li class="chapter" data-level="2.5" data-path="Intro.html"><a href="Intro.html#example-data-for-barns-swallow"><i class="fa fa-check"></i><b>2.5</b> Example data for Barns Swallow</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Stratify.html"><a href="Stratify.html"><i class="fa fa-check"></i><b>3</b> Stratification</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Stratify.html"><a href="Stratify.html#strata"><i class="fa fa-check"></i><b>3.1</b> Strata</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="Stratify.html"><a href="Stratify.html#accessing-the-strata-maps"><i class="fa fa-check"></i><b>3.1.1</b> Accessing the strata maps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="DataPrep.html"><a href="DataPrep.html"><i class="fa fa-check"></i><b>4</b> Prepare the data for a model and species</a>
<ul>
<li class="chapter" data-level="4.1" data-path="DataPrep.html"><a href="DataPrep.html#prepare-data"><i class="fa fa-check"></i><b>4.1</b> Prepare data</a></li>
<li class="chapter" data-level="4.2" data-path="DataPrep.html"><a href="DataPrep.html#Model_list"><i class="fa fa-check"></i><b>4.2</b> Models</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="DataPrep.html"><a href="DataPrep.html#slope"><i class="fa fa-check"></i><b>4.2.1</b> slope</a></li>
<li class="chapter" data-level="4.2.2" data-path="DataPrep.html"><a href="DataPrep.html#gam"><i class="fa fa-check"></i><b>4.2.2</b> gam</a></li>
<li class="chapter" data-level="4.2.3" data-path="DataPrep.html"><a href="DataPrep.html#gamye"><i class="fa fa-check"></i><b>4.2.3</b> gamye</a></li>
<li class="chapter" data-level="4.2.4" data-path="DataPrep.html"><a href="DataPrep.html#firstdiff"><i class="fa fa-check"></i><b>4.2.4</b> firstdiff</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="DataPrep.html"><a href="DataPrep.html#cws-analysis-example"><i class="fa fa-check"></i><b>4.3</b> CWS analysis example</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ModelRun.html"><a href="ModelRun.html"><i class="fa fa-check"></i><b>5</b> Running the model</a>
<ul>
<li class="chapter" data-level="5.1" data-path="ModelRun.html"><a href="ModelRun.html#pacfic-wren-example"><i class="fa fa-check"></i><b>5.1</b> Pacfic Wren example</a></li>
<li class="chapter" data-level="5.2" data-path="ModelRun.html"><a href="ModelRun.html#convergence-of-the-mcmc"><i class="fa fa-check"></i><b>5.2</b> Convergence of the MCMC</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="IndicesTrends.html"><a href="IndicesTrends.html"><i class="fa fa-check"></i><b>6</b> Estimating Annual Indices and Trends</a>
<ul>
<li class="chapter" data-level="6.1" data-path="IndicesTrends.html"><a href="IndicesTrends.html#annual-indices"><i class="fa fa-check"></i><b>6.1</b> Annual Indices</a></li>
<li class="chapter" data-level="6.2" data-path="IndicesTrends.html"><a href="IndicesTrends.html#population-trends"><i class="fa fa-check"></i><b>6.2</b> Population Trends</a></li>
<li class="chapter" data-level="6.3" data-path="IndicesTrends.html"><a href="IndicesTrends.html#alternative-time-spans-for-trends"><i class="fa fa-check"></i><b>6.3</b> Alternative time-spans for trends</a></li>
<li class="chapter" data-level="6.4" data-path="IndicesTrends.html"><a href="IndicesTrends.html#alternative-definitions-of-trends"><i class="fa fa-check"></i><b>6.4</b> Alternative definitions of trends</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="IndicesTrends.html"><a href="IndicesTrends.html#percent-change-and-probability-of-change"><i class="fa fa-check"></i><b>6.4.1</b> Percent Change and probability of change</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="IndicesTrends.html"><a href="IndicesTrends.html#changing-trends-through-time"><i class="fa fa-check"></i><b>6.5</b> Changing trends through time</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="GraphMap.html"><a href="GraphMap.html"><i class="fa fa-check"></i><b>7</b> Trajectory graphs and trend maps</a>
<ul>
<li class="chapter" data-level="7.1" data-path="GraphMap.html"><a href="GraphMap.html#graphing-the-trajectories-annual-indices"><i class="fa fa-check"></i><b>7.1</b> Graphing the trajectories (annual indices)</a></li>
<li class="chapter" data-level="7.2" data-path="GraphMap.html"><a href="GraphMap.html#adding-elements-to-indices-plots"><i class="fa fa-check"></i><b>7.2</b> Adding elements to indices plots</a></li>
<li class="chapter" data-level="7.3" data-path="GraphMap.html"><a href="GraphMap.html#mapping-the-trends"><i class="fa fa-check"></i><b>7.3</b> Mapping the trends</a></li>
<li class="chapter" data-level="7.4" data-path="GraphMap.html"><a href="GraphMap.html#geofacet-trajectories"><i class="fa fa-check"></i><b>7.4</b> Geofacet Trajectories</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Adv.html"><a href="Adv.html"><i class="fa fa-check"></i><b>8</b> Advanced options</a>
<ul>
<li class="chapter" data-level="8.1" data-path="Adv.html"><a href="Adv.html#custom-regional-summaries"><i class="fa fa-check"></i><b>8.1</b> Custom regional summaries</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="Adv.html"><a href="Adv.html#define-the-custom-regions-as-a-collection-of-the-existing-strata."><i class="fa fa-check"></i><b>8.1.1</b> Define the custom regions as a collection of the existing strata.</a></li>
<li class="chapter" data-level="8.1.2" data-path="Adv.html"><a href="Adv.html#use-defined-regions-to-estimate-indices-and-trends"><i class="fa fa-check"></i><b>8.1.2</b> Use defined regions to estimate indices and trends</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="Adv.html"><a href="Adv.html#exporting-the-jags-model"><i class="fa fa-check"></i><b>8.2</b> Exporting the JAGS model</a></li>
<li class="chapter" data-level="8.3" data-path="Adv.html"><a href="Adv.html#customizing-the-jags-model-and-data"><i class="fa fa-check"></i><b>8.3</b> Customizing the JAGS model and data</a></li>
<li class="chapter" data-level="8.4" data-path="Adv.html"><a href="Adv.html#comparing-models"><i class="fa fa-check"></i><b>8.4</b> Comparing Models</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Ref.html"><a href="Ref.html"><i class="fa fa-check"></i><b>9</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Quick Introduction to bbsBayes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="IndicesTrends" class="section level1" number="6">
<h1><span class="header-section-number">Chapter 6</span> Estimating Annual Indices and Trends</h1>
<p>Once the model has finished running, we can use the saved output to calculate the population trajectories and trends. As an example, we’ll load some saved model output for Barn Swallow, from the gamye model. If you haven’t already, you can download the model output file <a href="https://drive.google.com/drive/folders/1ar7nUNI3GXm1A_Kcoc2cAUQQ7ZV37wC6?usp=sharing">here</a>, then save it into your working directory.</p>
<p>This saved workspace includes two objects:</p>
<ol style="list-style-type: decimal">
<li><p>jags_data - the data object created with the <code>prepare_jags_data()</code> function.</p></li>
<li><p>jags_mod - the model output created with the <code>run_model()</code> function.</p></li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="IndicesTrends.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/gamye_Barn_Swallow/jags_mod_full.RData&quot;</span>)</span></code></pre></div>
<div id="annual-indices" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Annual Indices</h2>
<p>The annual indices of relative abundance (“annual indices”) from all of the bbsBayes models represent the expected mean count on the BBS routes in a given region and year. The time-series of these annual indices in a given region make up the estimated population trajectory.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="IndicesTrends.html#cb18-1" aria-hidden="true" tabindex="-1"></a>indices <span class="ot">&lt;-</span> <span class="fu">generate_indices</span>(<span class="at">jags_mod =</span> jags_mod,</span>
<span id="cb18-2"><a href="IndicesTrends.html#cb18-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">jags_data =</span> jags_data)</span>
<span id="cb18-3"><a href="IndicesTrends.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Note: this function can take ~20 minutes to run for a species with a broad range (many strata) and if the model run included a long time-series (many years).</span></span></code></pre></div>
<p>By default, this function generates estimates for the continent (i.e., survey-wide) and for the individual strata. However, if using one of the two BBS stratifications “bbs_usgs” or “bbs_cws,” the user can also select summaries for composite regions (regions made up of collections of strata), such as countries, provinces/states, Bird Conservation Regions, etc.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="IndicesTrends.html#cb19-1" aria-hidden="true" tabindex="-1"></a>indices <span class="ot">&lt;-</span> <span class="fu">generate_indices</span>(<span class="at">jags_mod =</span> jags_mod,</span>
<span id="cb19-2"><a href="IndicesTrends.html#cb19-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">jags_data =</span> jags_data,</span>
<span id="cb19-3"><a href="IndicesTrends.html#cb19-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">regions =</span> <span class="fu">c</span>(<span class="st">&quot;continental&quot;</span>,</span>
<span id="cb19-4"><a href="IndicesTrends.html#cb19-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;national&quot;</span>,</span>
<span id="cb19-5"><a href="IndicesTrends.html#cb19-5" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;prov_state&quot;</span>,</span>
<span id="cb19-6"><a href="IndicesTrends.html#cb19-6" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;stratum&quot;</span>))</span>
<span id="cb19-7"><a href="IndicesTrends.html#cb19-7" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#also &quot;bcr&quot;, #BCR specific estimates</span></span>
<span id="cb19-8"><a href="IndicesTrends.html#cb19-8" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># &quot;bcr_by_country&quot; #e.g., splits the BCRs along the national borders</span></span></code></pre></div>
<p>The <code>generate_indices()</code> function creates a list that includes an object called data_summary, which is a dataframe with all of the estimated annual indices <code>indices$data_summary</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="IndicesTrends.html#cb20-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(indices<span class="sc">$</span>data_summary[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>,<span class="dv">14</span>,<span class="dv">15</span>,<span class="dv">16</span>)]))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Year</th>
<th align="left">Region</th>
<th align="left">Region_type</th>
<th align="right">Index</th>
<th align="right">Index_q_0.025</th>
<th align="right">Index_q_0.975</th>
<th align="right">obs_mean</th>
<th align="right">nrts</th>
<th align="right">nnzero</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1966</td>
<td align="left">Continental</td>
<td align="left">continental</td>
<td align="right">9.48</td>
<td align="right">8.64</td>
<td align="right">10.8</td>
<td align="right">2.36</td>
<td align="right">396</td>
<td align="right">338</td>
</tr>
<tr class="even">
<td align="right">1967</td>
<td align="left">Continental</td>
<td align="left">continental</td>
<td align="right">9.78</td>
<td align="right">9.05</td>
<td align="right">10.8</td>
<td align="right">4.87</td>
<td align="right">814</td>
<td align="right">670</td>
</tr>
<tr class="odd">
<td align="right">1968</td>
<td align="left">Continental</td>
<td align="left">continental</td>
<td align="right">10.23</td>
<td align="right">9.59</td>
<td align="right">11.1</td>
<td align="right">7.64</td>
<td align="right">869</td>
<td align="right">711</td>
</tr>
<tr class="even">
<td align="right">1969</td>
<td align="left">Continental</td>
<td align="left">continental</td>
<td align="right">10.66</td>
<td align="right">10.10</td>
<td align="right">11.4</td>
<td align="right">8.75</td>
<td align="right">1187</td>
<td align="right">963</td>
</tr>
<tr class="odd">
<td align="right">1970</td>
<td align="left">Continental</td>
<td align="left">continental</td>
<td align="right">11.09</td>
<td align="right">10.57</td>
<td align="right">11.7</td>
<td align="right">9.45</td>
<td align="right">1276</td>
<td align="right">1047</td>
</tr>
<tr class="even">
<td align="right">1971</td>
<td align="left">Continental</td>
<td align="left">continental</td>
<td align="right">11.36</td>
<td align="right">10.89</td>
<td align="right">11.9</td>
<td align="right">9.84</td>
<td align="right">1368</td>
<td align="right">1158</td>
</tr>
</tbody>
</table>
<p>For example, one may wish to export the annual indices to a text file that can be read using Microsoft Excel.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="IndicesTrends.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(indices<span class="sc">$</span>data_summary, <span class="st">&quot;Barn_Swallow_trajectories.csv&quot;</span>)</span></code></pre></div>
<p>The list also includes a number of other objects that retain the stratification information, strata area weights, and the full posterior samples for every estimated annual index. Generally these other objects are only used by subsequent functions and the user won’t access them directly.</p>
<p>The function also accepts the alternative annual indices, such as the smooth-only indices from the gamye model.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="IndicesTrends.html#cb22-1" aria-hidden="true" tabindex="-1"></a>indices_smooth <span class="ot">&lt;-</span> <span class="fu">generate_indices</span>(<span class="at">jags_mod =</span> jags_mod,</span>
<span id="cb22-2"><a href="IndicesTrends.html#cb22-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">jags_data =</span> jags_data,</span>
<span id="cb22-3"><a href="IndicesTrends.html#cb22-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">alternate_n =</span> <span class="st">&quot;n3&quot;</span>,</span>
<span id="cb22-4"><a href="IndicesTrends.html#cb22-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">regions =</span> <span class="fu">c</span>(<span class="st">&quot;continental&quot;</span>,</span>
<span id="cb22-5"><a href="IndicesTrends.html#cb22-5" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;national&quot;</span>,</span>
<span id="cb22-6"><a href="IndicesTrends.html#cb22-6" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;prov_state&quot;</span>,</span>
<span id="cb22-7"><a href="IndicesTrends.html#cb22-7" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;stratum&quot;</span>))</span>
<span id="cb22-8"><a href="IndicesTrends.html#cb22-8" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#also &quot;bcr&quot;, #BCR specific estimates</span></span>
<span id="cb22-9"><a href="IndicesTrends.html#cb22-9" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># &quot;bcr_by_country&quot; #e.g., splits the BCRs along the national borders</span></span></code></pre></div>
</div>
<div id="population-trends" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Population Trends</h2>
<p>Population trends can be calculated from the output of <code>generate_indices()</code>. The trends are expressed as geometric mean rates of change (%/year) between two points in time. <span class="math inline">\(Trend = 100*((\frac {n[Maxyear]}{n[Minyear]})^\frac {1}{(Maxyear-Minyear)}{)-1)}\)</span></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="IndicesTrends.html#cb23-1" aria-hidden="true" tabindex="-1"></a>trends <span class="ot">&lt;-</span> <span class="fu">generate_trends</span>(<span class="at">indices =</span> indices,</span>
<span id="cb23-2"><a href="IndicesTrends.html#cb23-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Min_year =</span> <span class="dv">1970</span>,</span>
<span id="cb23-3"><a href="IndicesTrends.html#cb23-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Max_year =</span> <span class="dv">2019</span>)</span></code></pre></div>
<p>The <code>generate_trends()</code> function returns a dataframe with 1 row for each unit of the region-types requested (i.e., 1 row for each stratum, 1 continental, etc.). The dataframe has at least 27 columns that report useful information related to each trend, including the start and end year of the trend, lists of included strata, total number of routes, number of strata, mean observed counts, and estimates of the % change in the population between the start and end years.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="IndicesTrends.html#cb24-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(trends[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">14</span>)]))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Start_year</th>
<th align="left">Region</th>
<th align="right">Trend</th>
<th align="right">Trend_Q0.025</th>
<th align="right">Trend_Q0.975</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1970</td>
<td align="left">Continental</td>
<td align="right">-0.816</td>
<td align="right">-0.941</td>
<td align="right">-0.699</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">CA</td>
<td align="right">-2.419</td>
<td align="right">-2.736</td>
<td align="right">-2.115</td>
</tr>
<tr class="odd">
<td align="right">1970</td>
<td align="left">US</td>
<td align="right">-0.314</td>
<td align="right">-0.427</td>
<td align="right">-0.213</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">AB</td>
<td align="right">-1.961</td>
<td align="right">-2.723</td>
<td align="right">-1.257</td>
</tr>
<tr class="odd">
<td align="right">1970</td>
<td align="left">AK</td>
<td align="right">-5.451</td>
<td align="right">-8.247</td>
<td align="right">-2.611</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">AL</td>
<td align="right">2.439</td>
<td align="right">1.805</td>
<td align="right">3.053</td>
</tr>
</tbody>
</table>
<p>The <code>generate_trends</code> function includes some other arguments that allow the user to adjust the quantiles used to summarize uncertainty (e.g., interquartile range of the trend estiamtes, or the 67% CIs), as well as include additional calculations, such as the probability a population has declined (or increased) by &gt; X%.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="IndicesTrends.html#cb25-1" aria-hidden="true" tabindex="-1"></a>trends_10 <span class="ot">&lt;-</span> <span class="fu">generate_trends</span>(<span class="at">indices =</span> indices,</span>
<span id="cb25-2"><a href="IndicesTrends.html#cb25-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Min_year =</span> <span class="dv">2009</span>,</span>
<span id="cb25-3"><a href="IndicesTrends.html#cb25-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Max_year =</span> <span class="dv">2019</span>,</span>
<span id="cb25-4"><a href="IndicesTrends.html#cb25-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_decrease =</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">50</span>),</span>
<span id="cb25-5"><a href="IndicesTrends.html#cb25-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_increase =</span> <span class="fu">c</span>(<span class="dv">0</span>))</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="IndicesTrends.html#cb26-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(trends[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">15</span>,<span class="dv">22</span>)]))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Start_year</th>
<th align="left">Region_alt</th>
<th align="right">Trend</th>
<th align="right">Percent_Change</th>
<th align="right">Relative_Abundance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1970</td>
<td align="left">Continental</td>
<td align="right">-0.816</td>
<td align="right">-33.1</td>
<td align="right">10.95</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">Canada</td>
<td align="right">-2.419</td>
<td align="right">-69.9</td>
<td align="right">6.35</td>
</tr>
<tr class="odd">
<td align="right">1970</td>
<td align="left">United States of America</td>
<td align="right">-0.314</td>
<td align="right">-14.3</td>
<td align="right">13.85</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">Alberta</td>
<td align="right">-1.961</td>
<td align="right">-62.1</td>
<td align="right">6.72</td>
</tr>
<tr class="odd">
<td align="right">1970</td>
<td align="left">ALASKA</td>
<td align="right">-5.451</td>
<td align="right">-93.6</td>
<td align="right">1.94</td>
</tr>
<tr class="even">
<td align="right">1970</td>
<td align="left">ALABAMA</td>
<td align="right">2.439</td>
<td align="right">225.7</td>
<td align="right">18.58</td>
</tr>
</tbody>
</table>
<p>And trends calculated from the smooth component can be derived from the related annual indices.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="IndicesTrends.html#cb27-1" aria-hidden="true" tabindex="-1"></a>trends_smooth <span class="ot">&lt;-</span> <span class="fu">generate_trends</span>(<span class="at">indices =</span> indices_smooth,</span>
<span id="cb27-2"><a href="IndicesTrends.html#cb27-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Min_year =</span> <span class="dv">1970</span>,</span>
<span id="cb27-3"><a href="IndicesTrends.html#cb27-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Max_year =</span> <span class="dv">2019</span>,</span>
<span id="cb27-4"><a href="IndicesTrends.html#cb27-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_decrease =</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">50</span>),</span>
<span id="cb27-5"><a href="IndicesTrends.html#cb27-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_increase =</span> <span class="fu">c</span>(<span class="dv">0</span>))</span>
<span id="cb27-6"><a href="IndicesTrends.html#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="IndicesTrends.html#cb27-7" aria-hidden="true" tabindex="-1"></a>trends_smooth_10 <span class="ot">&lt;-</span> <span class="fu">generate_trends</span>(<span class="at">indices =</span> indices_smooth,</span>
<span id="cb27-8"><a href="IndicesTrends.html#cb27-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Min_year =</span> <span class="dv">2009</span>,</span>
<span id="cb27-9"><a href="IndicesTrends.html#cb27-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Max_year =</span> <span class="dv">2019</span>,</span>
<span id="cb27-10"><a href="IndicesTrends.html#cb27-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_decrease =</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">50</span>),</span>
<span id="cb27-11"><a href="IndicesTrends.html#cb27-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_increase =</span> <span class="fu">c</span>(<span class="dv">0</span>))</span></code></pre></div>
</div>
<div id="alternative-time-spans-for-trends" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Alternative time-spans for trends</h2>
<p>It is simple to estimate trends for alternative intervals of time. For example, calculating a 15 year trend for Barn Swallow.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="IndicesTrends.html#cb28-1" aria-hidden="true" tabindex="-1"></a>trends_smooth_15 <span class="ot">&lt;-</span> <span class="fu">generate_trends</span>(<span class="at">indices =</span> indices_smooth,</span>
<span id="cb28-2"><a href="IndicesTrends.html#cb28-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Min_year =</span> (<span class="dv">2019-15</span>),</span>
<span id="cb28-3"><a href="IndicesTrends.html#cb28-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Max_year =</span> <span class="dv">2019</span>,</span>
<span id="cb28-4"><a href="IndicesTrends.html#cb28-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_decrease =</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">50</span>),</span>
<span id="cb28-5"><a href="IndicesTrends.html#cb28-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_increase =</span> <span class="fu">c</span>(<span class="dv">0</span>)) </span></code></pre></div>
<p>Or, a 15-year trend for the previous 15 years, i.e., the interval from 1989-2004:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="IndicesTrends.html#cb29-1" aria-hidden="true" tabindex="-1"></a>trends_smooth_15alt <span class="ot">&lt;-</span> <span class="fu">generate_trends</span>(<span class="at">indices =</span> indices_smooth,</span>
<span id="cb29-2"><a href="IndicesTrends.html#cb29-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Min_year =</span> <span class="dv">1989</span>,</span>
<span id="cb29-3"><a href="IndicesTrends.html#cb29-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Max_year =</span> <span class="dv">2004</span>,</span>
<span id="cb29-4"><a href="IndicesTrends.html#cb29-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_decrease =</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">50</span>),</span>
<span id="cb29-5"><a href="IndicesTrends.html#cb29-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_increase =</span> <span class="fu">c</span>(<span class="dv">0</span>))</span></code></pre></div>
</div>
<div id="alternative-definitions-of-trends" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Alternative definitions of trends</h2>
<p>The end-point trend definition introduced by <span class="citation">(<a href="Ref.html#ref-link2002a" role="doc-biblioref">Link and Sauer 2002b</a>)</span> is only one possible metric to measure a population trend. The default trend calculation is an interval-specific estimate of the geometric mean annual change in the population. <span class="math inline">\(Trend = 100*((\frac {n[Maxyear]}{n[Minyear]})^\frac {1}{(Maxyear-Minyear)}{)-1)}\)</span> It relies on a comparison of the annual indices in the first and last years of the trend period to quantify the mean rate of population change. However, it ignores the pattern of change between the two end-points.</p>
<p>The user can choose an alternative estimate of change that is calculated by fitting a log-linear slope to the series of all annual indices between the two end-points (e.g., all 11 years in a 10-year trend from 2008-2018). The slope of this line could be expressed as an average annual percent change across the time-period of interest. If working with estimates derived from a model with strong annual fluctuations and for which no decomposition is possible (e.g., “firstdiff” model), this slope-based trend may be a more comprehensive measure of the average population change, that is less dependent on the particular end-point years. These slope trends can be added to the trend output table by setting the <code>slope = TRUE</code> argument in <code>generate_trends()</code>. The standard trends are still calculated, but additional columns are added that include the alternate estimates. NOTE: the <code>generate_map()</code> function can map slope trends as well with the same <code>slope = TRUE</code> argument.</p>
<p>For example, we could use the full annual indices from the gamye model (indices including the annual fluctuations) to calculate both the default end-point trends and the alternative slope trends.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="IndicesTrends.html#cb30-1" aria-hidden="true" tabindex="-1"></a>trends_15_slope <span class="ot">&lt;-</span> <span class="fu">generate_trends</span>(<span class="at">indices =</span> indices,</span>
<span id="cb30-2"><a href="IndicesTrends.html#cb30-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Min_year =</span> (<span class="dv">2019-15</span>),</span>
<span id="cb30-3"><a href="IndicesTrends.html#cb30-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">slope =</span> <span class="cn">TRUE</span>,</span>
<span id="cb30-4"><a href="IndicesTrends.html#cb30-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Max_year =</span> <span class="dv">2019</span>,</span>
<span id="cb30-5"><a href="IndicesTrends.html#cb30-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_decrease =</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">50</span>),</span>
<span id="cb30-6"><a href="IndicesTrends.html#cb30-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_increase =</span> <span class="fu">c</span>(<span class="dv">0</span>))</span></code></pre></div>
<p>Setting <code>slope = TRUE</code> adds the slope-trend calculation to the output dataframe. Note: The probabilities of decrease and increase values are not based on the slope metric, they are always a function of the difference in population between the start and end of the time-interval.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="IndicesTrends.html#cb31-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(trends_15_slope[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">22</span>)]))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Start_year</th>
<th align="left">Region_alt</th>
<th align="right">Trend</th>
<th align="right">Slope_Trend</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2004</td>
<td align="left">Continental</td>
<td align="right">-1.262</td>
<td align="right">-1.282</td>
</tr>
<tr class="even">
<td align="right">2004</td>
<td align="left">Canada</td>
<td align="right">-0.524</td>
<td align="right">-0.274</td>
</tr>
<tr class="odd">
<td align="right">2004</td>
<td align="left">United States of America</td>
<td align="right">-1.386</td>
<td align="right">-1.443</td>
</tr>
<tr class="even">
<td align="right">2004</td>
<td align="left">Alberta</td>
<td align="right">-1.832</td>
<td align="right">-1.750</td>
</tr>
<tr class="odd">
<td align="right">2004</td>
<td align="left">ALASKA</td>
<td align="right">-4.449</td>
<td align="right">-4.828</td>
</tr>
<tr class="even">
<td align="right">2004</td>
<td align="left">ALABAMA</td>
<td align="right">-2.652</td>
<td align="right">-2.414</td>
</tr>
</tbody>
</table>
<div id="percent-change-and-probability-of-change" class="section level3" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Percent Change and probability of change</h3>
<p>The <code>generate_trends()</code> function also produces estimates of the overall percent-change in the population between the first and last years of the trend-period. This calculation is often easier to interpret than an average annual rate of change. These percent change estimates have associated uncertainty bounds, and so can be helpful for deriving statements such as “between 2008 and 2018, the population has declined by 20 percent, but that estimate is relatively uncertain and the true decline may be as little as 2 percent or as much as 50 percent”</p>
<p>In addition, the function can optionally calculate the posterior conditional probability that a population has changed by at least a certain amount, using the <code>prob_decrease</code> and <code>prob_increase</code> arguments. These values can be useful for deriving statements such as “our model suggests that there is a 95% probability that the species has increased (i.e., &gt; 0% increase) and a 45 percent probability that the species has increased more than 2-fold (i.e., &gt; 100% increase)”</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="IndicesTrends.html#cb32-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(trends_smooth_15[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">15</span>,<span class="dv">22</span>)]))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Start_year</th>
<th align="left">Region_alt</th>
<th align="right">Trend</th>
<th align="right">Percent_Change</th>
<th align="right">prob_decrease_30_percent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2004</td>
<td align="left">Continental</td>
<td align="right">-1.119</td>
<td align="right">-15.53</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">2004</td>
<td align="left">Canada</td>
<td align="right">-0.315</td>
<td align="right">-4.62</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">2004</td>
<td align="left">United States of America</td>
<td align="right">-1.255</td>
<td align="right">-17.26</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">2004</td>
<td align="left">Alberta</td>
<td align="right">-1.854</td>
<td align="right">-24.47</td>
<td align="right">0.246</td>
</tr>
<tr class="odd">
<td align="right">2004</td>
<td align="left">ALASKA</td>
<td align="right">-4.551</td>
<td align="right">-50.28</td>
<td align="right">0.806</td>
</tr>
<tr class="even">
<td align="right">2004</td>
<td align="left">ALABAMA</td>
<td align="right">-2.481</td>
<td align="right">-31.40</td>
<td align="right">0.597</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="changing-trends-through-time" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Changing trends through time</h2>
<p>Changes in populations, both annual rates of change (trends) and overall changes in populations (percent change), are often used to prioritize species in conservation assessments. For example, the International Union for the Conservation of Nature (IUCN) or the Committee on the Status of Endangered Wildlife in Canada (COSEWIC) use estimates of population change over three generations to classify species as Endangered or Threatened. Of course the estimate of population trend used to classify a species is at least partly dependent on the year in which the species is assessed. Populations rarely follow constant rates of log-linear change through time, and so estimates of change also change through time. To quantify and visualize these changes in trends, one can estimate a series of trends for a rolling window of time-intervals. As an example, the annual CWS analysis includes an estimate of all possible 10-year trends for each species, which we refer to as the rolling trends analysis. Conceptually, it is relatively simple, and just involves estimating the annual indices for the full time-series of the survey, and then embedding the <code>generate_trends()</code> function within a loop.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="IndicesTrends.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb33-2"><a href="IndicesTrends.html#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="IndicesTrends.html#cb33-3" aria-hidden="true" tabindex="-1"></a>indices_smooth_national <span class="ot">&lt;-</span> <span class="fu">generate_indices</span>(<span class="at">jags_mod =</span> jags_mod,</span>
<span id="cb33-4"><a href="IndicesTrends.html#cb33-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">jags_data =</span> jags_data,</span>
<span id="cb33-5"><a href="IndicesTrends.html#cb33-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">alternate_n =</span> <span class="st">&quot;n3&quot;</span>, <span class="co"># the smooth only component of the gamye model</span></span>
<span id="cb33-6"><a href="IndicesTrends.html#cb33-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">regions =</span> <span class="fu">c</span>(<span class="st">&quot;continental&quot;</span>,</span>
<span id="cb33-7"><a href="IndicesTrends.html#cb33-7" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;national&quot;</span>)) <span class="co">#only continental and national estimates</span></span>
<span id="cb33-8"><a href="IndicesTrends.html#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="IndicesTrends.html#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="IndicesTrends.html#cb33-10" aria-hidden="true" tabindex="-1"></a>first_year <span class="ot">&lt;-</span> <span class="fu">min</span>(indices_smooth_national<span class="sc">$</span>data_summary<span class="sc">$</span>Year) <span class="co">#First year in the time-series</span></span>
<span id="cb33-11"><a href="IndicesTrends.html#cb33-11" aria-hidden="true" tabindex="-1"></a>last_year <span class="ot">&lt;-</span> <span class="fu">max</span>(indices_smooth_national<span class="sc">$</span>data_summary<span class="sc">$</span>Year) <span class="co">#Last year in the time-series</span></span>
<span id="cb33-12"><a href="IndicesTrends.html#cb33-12" aria-hidden="true" tabindex="-1"></a>trend_time <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="co">#use 10-year trends</span></span>
<span id="cb33-13"><a href="IndicesTrends.html#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="IndicesTrends.html#cb33-14" aria-hidden="true" tabindex="-1"></a>trends_out <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb33-15"><a href="IndicesTrends.html#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="IndicesTrends.html#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(Y <span class="cf">in</span> first_year<span class="sc">:</span>(last_year<span class="sc">-</span>trend_time)){</span>
<span id="cb33-17"><a href="IndicesTrends.html#cb33-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-18"><a href="IndicesTrends.html#cb33-18" aria-hidden="true" tabindex="-1"></a>trends_temp <span class="ot">&lt;-</span> <span class="fu">generate_trends</span>(<span class="at">indices =</span> indices_smooth_national,</span>
<span id="cb33-19"><a href="IndicesTrends.html#cb33-19" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Min_year =</span> Y,</span>
<span id="cb33-20"><a href="IndicesTrends.html#cb33-20" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Max_year =</span> Y<span class="sc">+</span>trend_time,</span>
<span id="cb33-21"><a href="IndicesTrends.html#cb33-21" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_decrease =</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">50</span>),</span>
<span id="cb33-22"><a href="IndicesTrends.html#cb33-22" aria-hidden="true" tabindex="-1"></a>                          <span class="at">prob_increase =</span> <span class="fu">c</span>(<span class="dv">0</span>))</span>
<span id="cb33-23"><a href="IndicesTrends.html#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="IndicesTrends.html#cb33-24" aria-hidden="true" tabindex="-1"></a>    trends_out <span class="ot">=</span> <span class="fu">rbind</span>(trends_out,trends_temp)</span>
<span id="cb33-25"><a href="IndicesTrends.html#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="IndicesTrends.html#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="IndicesTrends.html#cb33-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-28"><a href="IndicesTrends.html#cb33-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-29"><a href="IndicesTrends.html#cb33-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-30"><a href="IndicesTrends.html#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="IndicesTrends.html#cb33-31" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(trends_out[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">22</span>)]))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Start_year</th>
<th align="right">End_year</th>
<th align="left">Region_alt</th>
<th align="right">Trend</th>
<th align="right">prob_decrease_30_percent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1966</td>
<td align="right">1976</td>
<td align="left">Continental</td>
<td align="right">3.54</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">1966</td>
<td align="right">1976</td>
<td align="left">Canada</td>
<td align="right">1.36</td>
<td align="right">0.002</td>
</tr>
<tr class="odd">
<td align="right">1966</td>
<td align="right">1976</td>
<td align="left">United States of America</td>
<td align="right">4.72</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">1967</td>
<td align="right">1977</td>
<td align="left">Continental</td>
<td align="right">3.42</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">1967</td>
<td align="right">1977</td>
<td align="left">Canada</td>
<td align="right">1.40</td>
<td align="right">0.001</td>
</tr>
<tr class="even">
<td align="right">1967</td>
<td align="right">1977</td>
<td align="left">United States of America</td>
<td align="right">4.47</td>
<td align="right">0.000</td>
</tr>
</tbody>
</table>
<p>Now the <code>trends_out</code> object is a dataframe with all of the trend estimates, which we could export to a file or use to plot the estimated trends through time.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="IndicesTrends.html#cb34-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-2"><a href="IndicesTrends.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel) <span class="co">#handy ggplot labeling extension</span></span>
<span id="cb34-3"><a href="IndicesTrends.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) <span class="co">#handy colour palettes</span></span>
<span id="cb34-4"><a href="IndicesTrends.html#cb34-4" aria-hidden="true" tabindex="-1"></a>c_orng <span class="ot">=</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">9</span>,<span class="st">&quot;Set1&quot;</span>)[<span class="dv">5</span>]</span>
<span id="cb34-5"><a href="IndicesTrends.html#cb34-5" aria-hidden="true" tabindex="-1"></a>c_red <span class="ot">=</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">9</span>,<span class="st">&quot;Set1&quot;</span>)[<span class="dv">1</span>]</span>
<span id="cb34-6"><a href="IndicesTrends.html#cb34-6" aria-hidden="true" tabindex="-1"></a>c_blue <span class="ot">=</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="dv">9</span>,<span class="st">&quot;Set1&quot;</span>)[<span class="dv">2</span>]</span>
<span id="cb34-7"><a href="IndicesTrends.html#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="IndicesTrends.html#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="IndicesTrends.html#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="IndicesTrends.html#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># selecting just the trends for Canada</span></span>
<span id="cb34-11"><a href="IndicesTrends.html#cb34-11" aria-hidden="true" tabindex="-1"></a>    trends_canada <span class="ot">=</span> trends_out[<span class="fu">which</span>(trends_out<span class="sc">$</span>Region_alt <span class="sc">==</span> <span class="st">&quot;Canada&quot;</span>),]</span>
<span id="cb34-12"><a href="IndicesTrends.html#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># adding column names to identify which credible intervals to plot below</span></span>
<span id="cb34-13"><a href="IndicesTrends.html#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># also adding labels that are ggplot friendly (they do not include &quot;.&quot;)</span></span>
<span id="cb34-14"><a href="IndicesTrends.html#cb34-14" aria-hidden="true" tabindex="-1"></a>    trends_canada<span class="sc">$</span>lci <span class="ot">=</span> trends_canada<span class="sc">$</span>Trend_Q0<span class="fl">.025</span></span>
<span id="cb34-15"><a href="IndicesTrends.html#cb34-15" aria-hidden="true" tabindex="-1"></a>    trends_canada<span class="sc">$</span>uci <span class="ot">=</span> trends_canada<span class="sc">$</span>Trend_Q0<span class="fl">.975</span></span>
<span id="cb34-16"><a href="IndicesTrends.html#cb34-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-17"><a href="IndicesTrends.html#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="IndicesTrends.html#cb34-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-19"><a href="IndicesTrends.html#cb34-19" aria-hidden="true" tabindex="-1"></a>   <span class="co"># pulling out one row of the data frame to help annotate the plot </span></span>
<span id="cb34-20"><a href="IndicesTrends.html#cb34-20" aria-hidden="true" tabindex="-1"></a>    trends_canadaend4 <span class="ot">=</span> trends_canada[<span class="fu">nrow</span>(trends_canada)<span class="sc">-</span><span class="dv">4</span>,]</span>
<span id="cb34-21"><a href="IndicesTrends.html#cb34-21" aria-hidden="true" tabindex="-1"></a>    trends_canadaend4<span class="sc">$</span>lab50 <span class="ot">=</span> <span class="st">&quot;50% CI&quot;</span></span>
<span id="cb34-22"><a href="IndicesTrends.html#cb34-22" aria-hidden="true" tabindex="-1"></a>    trends_canadaend4<span class="sc">$</span>lab95 <span class="ot">=</span> <span class="st">&quot;95% CI&quot;</span></span>
<span id="cb34-23"><a href="IndicesTrends.html#cb34-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-24"><a href="IndicesTrends.html#cb34-24" aria-hidden="true" tabindex="-1"></a>    trends_canadaend <span class="ot">=</span> trends_canada[<span class="fu">nrow</span>(trends_canada),]</span>
<span id="cb34-25"><a href="IndicesTrends.html#cb34-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-26"><a href="IndicesTrends.html#cb34-26" aria-hidden="true" tabindex="-1"></a>    pth_30_labs <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">signif</span>(<span class="dv">100</span><span class="sc">*</span>trends_canadaend[,<span class="st">&quot;prob_decrease_30_percent&quot;</span>],<span class="dv">2</span>),<span class="st">&quot;% probability of 30% decrease&quot;</span>) </span>
<span id="cb34-27"><a href="IndicesTrends.html#cb34-27" aria-hidden="true" tabindex="-1"></a>    pth_50_labs <span class="ot">=</span> <span class="fu">paste0</span>(<span class="fu">signif</span>(<span class="dv">100</span><span class="sc">*</span>trends_canadaend[,<span class="st">&quot;prob_decrease_50_percent&quot;</span>],<span class="dv">2</span>),<span class="st">&quot;% probability of 50% decrease&quot;</span>) </span>
<span id="cb34-28"><a href="IndicesTrends.html#cb34-28" aria-hidden="true" tabindex="-1"></a>    trends_canadaend<span class="sc">$</span>pdec <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">signif</span>(trends_canadaend[,<span class="st">&quot;Percent_Change&quot;</span>],<span class="dv">2</span>),<span class="st">&quot;% Change over&quot;</span>,trend_time,<span class="st">&quot;years&quot;</span>) </span>
<span id="cb34-29"><a href="IndicesTrends.html#cb34-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-30"><a href="IndicesTrends.html#cb34-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># a few extra objects to further annotate the plot</span></span>
<span id="cb34-31"><a href="IndicesTrends.html#cb34-31" aria-hidden="true" tabindex="-1"></a>  thresh30 <span class="ot">=</span> (<span class="fl">0.7</span><span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>trend_time)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span> <span class="co"># threshold trend value for a 30% decline over 10-years</span></span>
<span id="cb34-32"><a href="IndicesTrends.html#cb34-32" aria-hidden="true" tabindex="-1"></a>  thresh50 <span class="ot">=</span> (<span class="fl">0.5</span><span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>trend_time)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span> <span class="co"># threshold trend value for a 50% decline over 10-years</span></span>
<span id="cb34-33"><a href="IndicesTrends.html#cb34-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-34"><a href="IndicesTrends.html#cb34-34" aria-hidden="true" tabindex="-1"></a>  threshs <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">thresh =</span> <span class="fu">c</span>(thresh30,thresh50),</span>
<span id="cb34-35"><a href="IndicesTrends.html#cb34-35" aria-hidden="true" tabindex="-1"></a>                       <span class="at">p_thresh =</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">&quot;-30% over&quot;</span>,trend_time,<span class="st">&quot;years&quot;</span>),</span>
<span id="cb34-36"><a href="IndicesTrends.html#cb34-36" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">paste</span>(<span class="st">&quot;-50% over&quot;</span>,trend_time,<span class="st">&quot;years&quot;</span>)),</span>
<span id="cb34-37"><a href="IndicesTrends.html#cb34-37" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Year =</span> <span class="fu">rep</span>(<span class="fu">min</span>(trends_canada<span class="sc">$</span>End_year),<span class="dv">2</span>))</span>
<span id="cb34-38"><a href="IndicesTrends.html#cb34-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-39"><a href="IndicesTrends.html#cb34-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-40"><a href="IndicesTrends.html#cb34-40" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-41"><a href="IndicesTrends.html#cb34-41" aria-hidden="true" tabindex="-1"></a>    cpt <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> trends_canada,<span class="fu">aes</span>(<span class="at">x =</span> End_year,<span class="at">y =</span> Trend))<span class="sc">+</span></span>
<span id="cb34-42"><a href="IndicesTrends.html#cb34-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb34-43"><a href="IndicesTrends.html#cb34-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Barn Swallow rolling&quot;</span>,trend_time,<span class="st">&quot;year trends for Canada&quot;</span>),</span>
<span id="cb34-44"><a href="IndicesTrends.html#cb34-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Based on Trend in&quot;</span>,last_year,<span class="st">&quot;:&quot;</span>,pth_30_labs,<span class="st">&quot;and&quot;</span>,pth_50_labs))<span class="sc">+</span></span>
<span id="cb34-45"><a href="IndicesTrends.html#cb34-45" aria-hidden="true" tabindex="-1"></a>           <span class="fu">xlab</span>(<span class="fu">paste</span>(<span class="st">&quot;Ending year of&quot;</span>,trend_time,<span class="st">&quot;trend&quot;</span>))<span class="sc">+</span></span>
<span id="cb34-46"><a href="IndicesTrends.html#cb34-46" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ylab</span>(<span class="fu">paste</span>(trend_time,<span class="st">&quot;year trends&quot;</span>))<span class="sc">+</span></span>
<span id="cb34-47"><a href="IndicesTrends.html#cb34-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> thresh30,<span class="at">colour =</span> c_orng)<span class="sc">+</span></span>
<span id="cb34-48"><a href="IndicesTrends.html#cb34-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> thresh50,<span class="at">colour =</span> c_red)<span class="sc">+</span></span>
<span id="cb34-49"><a href="IndicesTrends.html#cb34-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,<span class="at">colour =</span> <span class="fu">grey</span>(<span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb34-50"><a href="IndicesTrends.html#cb34-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_label_repel</span>(<span class="at">data =</span> threshs,<span class="fu">aes</span>(<span class="at">x =</span> Year,<span class="at">y =</span> thresh,<span class="at">label =</span> p_thresh),<span class="at">position =</span> <span class="st">&quot;nudge&quot;</span>)<span class="sc">+</span></span>
<span id="cb34-51"><a href="IndicesTrends.html#cb34-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> End_year,<span class="at">y =</span> Trend,<span class="at">ymin =</span> lci,<span class="at">ymax =</span> uci),<span class="at">colour =</span> c_blue)<span class="sc">+</span></span>
<span id="cb34-52"><a href="IndicesTrends.html#cb34-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text_repel</span>(<span class="at">data =</span> trends_canadaend,<span class="fu">aes</span>(<span class="at">x =</span> End_year,<span class="at">y =</span> Trend,<span class="at">label =</span> pdec),<span class="at">min.segment.length =</span> <span class="fl">0.1</span>,<span class="at">nudge_y =</span> <span class="fl">0.95</span>)</span>
<span id="cb34-53"><a href="IndicesTrends.html#cb34-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-54"><a href="IndicesTrends.html#cb34-54" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-55"><a href="IndicesTrends.html#cb34-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-56"><a href="IndicesTrends.html#cb34-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-57"><a href="IndicesTrends.html#cb34-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(cpt)</span>
<span id="cb34-58"><a href="IndicesTrends.html#cb34-58" aria-hidden="true" tabindex="-1"></a> </span></code></pre></div>
<p><img src="bbsBayes_Workshop_files/figure-html/IT%2019-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>
<p>And here’s the population trajectory for comparison. Note: the <code>plot_indices()</code> function that generated this plot is demonstrated in the next section <a href="GraphMap.html#GraphMap">7</a>.</p>
<p><img src="bbsBayes_Workshop_files/figure-html/IT20-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ModelRun.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="GraphMap.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bbsBayes_Workshop.pdf", "bbsBayes_Workshop.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
