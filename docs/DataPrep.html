<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Prepare the data for a model and species | A Quick Introduction to bbsBayes</title>
  <meta name="description" content="This is a document to support a ~2hr workshop." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Prepare the data for a model and species | A Quick Introduction to bbsBayes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a document to support a ~2hr workshop." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Prepare the data for a model and species | A Quick Introduction to bbsBayes" />
  
  <meta name="twitter:description" content="This is a document to support a ~2hr workshop." />
  

<meta name="author" content="Adam C. Smith, and Brandon P.M. Edwards" />


<meta name="date" content="2020-12-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="Stratify.html"/>
<link rel="next" href="ModelRun.html"/>
<script src="libs/header-attrs-2.4.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Quick Introduction to bbsBayes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Customized BBS trends, trajectories, graphs, and maps using the bbsBayes R-package, an Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#what-is-the-workshop-about"><i class="fa fa-check"></i><b>1.1</b> What is the workshop about?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#intended-audience"><i class="fa fa-check"></i><b>1.2</b> Intended Audience</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#what-we-hope-you-will-learn-here"><i class="fa fa-check"></i><b>1.3</b> What we hope you will learn here</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Intro.html"><a href="Intro.html"><i class="fa fa-check"></i><b>2</b> Preparation and Installation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="Intro.html"><a href="Intro.html#pre-workshop-preparation"><i class="fa fa-check"></i><b>2.1</b> Pre-Workshop preparation</a></li>
<li class="chapter" data-level="2.2" data-path="Intro.html"><a href="Intro.html#installation"><i class="fa fa-check"></i><b>2.2</b> Installation</a></li>
<li class="chapter" data-level="2.3" data-path="Intro.html"><a href="Intro.html#data-retrieval"><i class="fa fa-check"></i><b>2.3</b> Data Retrieval</a></li>
<li class="chapter" data-level="2.4" data-path="Intro.html"><a href="Intro.html#install-jags"><i class="fa fa-check"></i><b>2.4</b> Install JAGS</a></li>
<li class="chapter" data-level="2.5" data-path="Intro.html"><a href="Intro.html#example-data-for-scarlet-tanager"><i class="fa fa-check"></i><b>2.5</b> Example data for Scarlet Tanager</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="Stratify.html"><a href="Stratify.html"><i class="fa fa-check"></i><b>3</b> Stratification</a>
<ul>
<li class="chapter" data-level="3.1" data-path="Stratify.html"><a href="Stratify.html#strata"><i class="fa fa-check"></i><b>3.1</b> Strata</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="Stratify.html"><a href="Stratify.html#useful-code-to-access-and-print-the-strata-maps-above"><i class="fa fa-check"></i><b>3.1.1</b> Useful code to access and print the strata maps above</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="DataPrep.html"><a href="DataPrep.html"><i class="fa fa-check"></i><b>4</b> Prepare the data for a model and species</a>
<ul>
<li class="chapter" data-level="4.1" data-path="DataPrep.html"><a href="DataPrep.html#prepare-data"><i class="fa fa-check"></i><b>4.1</b> Prepare data</a></li>
<li class="chapter" data-level="4.2" data-path="DataPrep.html"><a href="DataPrep.html#models"><i class="fa fa-check"></i><b>4.2</b> Models</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="DataPrep.html"><a href="DataPrep.html#slope"><i class="fa fa-check"></i><b>4.2.1</b> slope</a></li>
<li class="chapter" data-level="4.2.2" data-path="DataPrep.html"><a href="DataPrep.html#gam"><i class="fa fa-check"></i><b>4.2.2</b> gam</a></li>
<li class="chapter" data-level="4.2.3" data-path="DataPrep.html"><a href="DataPrep.html#gamye"><i class="fa fa-check"></i><b>4.2.3</b> gamye</a></li>
<li class="chapter" data-level="4.2.4" data-path="DataPrep.html"><a href="DataPrep.html#firstdiff"><i class="fa fa-check"></i><b>4.2.4</b> firstdiff</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="DataPrep.html"><a href="DataPrep.html#cws-analysis-example"><i class="fa fa-check"></i><b>4.3</b> CWS analysis example</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="ModelRun.html"><a href="ModelRun.html"><i class="fa fa-check"></i><b>5</b> Running the model</a>
<ul>
<li class="chapter" data-level="5.1" data-path="ModelRun.html"><a href="ModelRun.html#pacfic-wren-example"><i class="fa fa-check"></i><b>5.1</b> Pacfic Wren example</a></li>
<li class="chapter" data-level="5.2" data-path="ModelRun.html"><a href="ModelRun.html#convergence-of-the-mcmc"><i class="fa fa-check"></i><b>5.2</b> Convergence of the MCMC</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="IndicesTrends.html"><a href="IndicesTrends.html"><i class="fa fa-check"></i><b>6</b> Estimating Annual Indices and Trends</a>
<ul>
<li class="chapter" data-level="6.1" data-path="IndicesTrends.html"><a href="IndicesTrends.html#annual-indices"><i class="fa fa-check"></i><b>6.1</b> Annual Indices</a></li>
<li class="chapter" data-level="6.2" data-path="IndicesTrends.html"><a href="IndicesTrends.html#population-trends"><i class="fa fa-check"></i><b>6.2</b> Population Trends</a></li>
<li class="chapter" data-level="6.3" data-path="IndicesTrends.html"><a href="IndicesTrends.html#alternative-time-spans-for-trends"><i class="fa fa-check"></i><b>6.3</b> Alternative time-spans for trends</a></li>
<li class="chapter" data-level="6.4" data-path="IndicesTrends.html"><a href="IndicesTrends.html#alternative-definitions-of-trends"><i class="fa fa-check"></i><b>6.4</b> Alternative definitions of trends</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="IndicesTrends.html"><a href="IndicesTrends.html#percent-change-and-probability-of-change"><i class="fa fa-check"></i><b>6.4.1</b> Percent Change and probability of change</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="GraphMap.html"><a href="GraphMap.html"><i class="fa fa-check"></i><b>7</b> Trajectory graphs and trend maps</a>
<ul>
<li class="chapter" data-level="7.1" data-path="GraphMap.html"><a href="GraphMap.html#graphing-the-trajectories-annual-indices"><i class="fa fa-check"></i><b>7.1</b> Graphing the trajectories (annual indices)</a></li>
<li class="chapter" data-level="7.2" data-path="GraphMap.html"><a href="GraphMap.html#adding-elements-to-indices-plots"><i class="fa fa-check"></i><b>7.2</b> Adding elements to indices plots</a></li>
<li class="chapter" data-level="7.3" data-path="GraphMap.html"><a href="GraphMap.html#mapping-the-trends"><i class="fa fa-check"></i><b>7.3</b> Mapping the trends</a></li>
<li class="chapter" data-level="7.4" data-path="GraphMap.html"><a href="GraphMap.html#geofacet-trajectories"><i class="fa fa-check"></i><b>7.4</b> Geofacet Trajectories</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="Adv.html"><a href="Adv.html"><i class="fa fa-check"></i><b>8</b> Advanced options</a>
<ul>
<li class="chapter" data-level="8.1" data-path="Adv.html"><a href="Adv.html#custom-regional-summaries"><i class="fa fa-check"></i><b>8.1</b> Custom regional summaries</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="Adv.html"><a href="Adv.html#define-the-custom-regions-as-a-collection-of-the-existing-strata."><i class="fa fa-check"></i><b>8.1.1</b> Define the custom regions as a collection of the existing strata.</a></li>
<li class="chapter" data-level="8.1.2" data-path="Adv.html"><a href="Adv.html#use-defined-regions-to-estimate-indices-and-trends"><i class="fa fa-check"></i><b>8.1.2</b> Use defined regions to estimate indices and trends</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="Adv.html"><a href="Adv.html#exporting-the-jags-model"><i class="fa fa-check"></i><b>8.2</b> Exporting the JAGS model</a></li>
<li class="chapter" data-level="8.3" data-path="Adv.html"><a href="Adv.html#customizing-the-jags-model-and-data"><i class="fa fa-check"></i><b>8.3</b> Customizing the JAGS model and data</a></li>
<li class="chapter" data-level="8.4" data-path="Adv.html"><a href="Adv.html#comparing-models"><i class="fa fa-check"></i><b>8.4</b> Comparing Models</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Ref.html"><a href="Ref.html"><i class="fa fa-check"></i><b>9</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Quick Introduction to bbsBayes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="DataPrep" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Prepare the data for a model and species</h1>
<div id="prepare-data" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Prepare data</h2>
<p>The <code>prepare_jags_data()</code> function is used to select a species, a model, the time-scale, etc.</p>
<p>The critical arguments are:</p>
<ul>
<li>strat_data: the list of stratified data returned by <code>stratify()</code></li>
<li>species_to_run: the English name for the species. This is currently case sensitive, and must exactly match one of the names in the english column of the species_strat object of strat_data i.e., <code>strat_data$species_strat$english</code>
If you’d like to export a full list of the available species, this code will work:</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="DataPrep.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(strat_data<span class="sc">$</span>species_strat,<span class="st">&quot;Full_BBS_speciesList.csv&quot;</span>)</span></code></pre></div>
<p>Also, if you’d like to select a species using the French name, you can try this approach:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="DataPrep.html#cb10-1" aria-hidden="true" tabindex="-1"></a>espece <span class="ot">=</span> <span class="st">&quot;Colibri à gorge rubis&quot;</span></span>
<span id="cb10-2"><a href="DataPrep.html#cb10-2" aria-hidden="true" tabindex="-1"></a>species <span class="ot">=</span> strat_data<span class="sc">$</span>species_strat<span class="sc">$</span>english[<span class="fu">which</span>(strat_data<span class="sc">$</span>species_strat<span class="sc">$</span>french <span class="sc">==</span> espece)]</span>
<span id="cb10-3"><a href="DataPrep.html#cb10-3" aria-hidden="true" tabindex="-1"></a>species</span>
<span id="cb10-4"><a href="DataPrep.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;Ruby-throated Hummingbird&quot;</span></span></code></pre></div>
<ul>
<li>model: the model to use, options are “slope,” “firstdiff,” “gam,” or “gamye”</li>
</ul>
<p>There are additional, optional arguments:</p>
<ul>
<li><p>heavy_tailed - Logical indicating whether the extra-Poisson error distribution should be modeled as a t-distribution, with heavier tails than the standard normal distribution. Default is currently FALSE, but recent research suggest users should strongly consider setting this to TRUE, even though it requires much longer convergence times</p></li>
<li><p>n_knots - Number of knots to be used in GAM function</p></li>
<li><p>min_year - Minimum year to keep in analysis</p></li>
<li><p>max_year - Maximum year to keep in analysis</p></li>
<li><p>min_n_routes - Minimum routes per strata where species has been observed. Defaults to 3, but consider lowering to 1 if using the “latlong” stratification</p></li>
<li><p>min_max_route_years - Minimum number of years with non-zero observations of species on at least 1 route. Defaults to 3</p></li>
<li><p>min_mean_route_years - Minimum average of years per route with the species observed. Defaults to 1.</p></li>
</ul>
</div>
<div id="models" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Models</h2>
<p>The package has (currently) four status and trend models that differ in the way they model the time-series of observations. The four model options are slope, gam, gamye, and firstdiff. <img src="images/AMKE_all.png"/></p>
<div id="slope" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> slope</h3>
<p>The slope option estimates the time series as a log-linear regression with random year-effect terms that allow the trajectory to depart from the smooth regression line. It is the model used by the USGS and CWS to estimate BBS trends between 2011 and 2018. The basic model was first described in 2002 <span class="citation">(<a href="Ref.html#ref-link2002" role="doc-biblioref">Link and Sauer 2002a</a>)</span> and its application to the annual status and trend estimates is documented in <span class="citation">(<a href="Ref.html#ref-sauer2011" role="doc-biblioref">Sauer and Link 2011</a>)</span> and <span class="citation">(<a href="Ref.html#ref-smith2014" role="doc-biblioref">Smith et al. 2014</a>)</span>.</p>
<p><img src="images/AMKE_slope.png"/></p>
</div>
<div id="gam" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> gam</h3>
<p>The gam option models the time series as a semiparametric smooth using a Generalized Additive Model (GAM) structure that shares information among the strata on the shape of the population trajectory. This model is described in <span class="citation">(<a href="Ref.html#ref-smith2020a" role="doc-biblioref">Smith and Edwards 2020</a>)</span>.</p>
<p><img src="images/AMKE_gam.png"/></p>
</div>
<div id="gamye" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> gamye</h3>
<p>The gamye option includes the semiparametric smooth used in the gam option, but also includes random year-effect terms that track annual fluctuations around the smooth, also in <span class="citation">(<a href="Ref.html#ref-smith2020a" role="doc-biblioref">Smith and Edwards 2020</a>)</span>. This is the model that the Canadian Wildlife Service is now using for the annual status and trend estimates.</p>
<p><img src="images/AMKE_gamye.png"/></p>
</div>
<div id="firstdiff" class="section level3" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> firstdiff</h3>
<p>The firstdiff option models the time-series as a random-walk from the first year, so that the first-differences of the sequence of year-effects are random effects with mean = 0 and an estimated variance. This model has been described in <span class="citation">(<a href="Ref.html#ref-link" role="doc-biblioref">Link, Sauer, and Niven, n.d.</a>)</span>. The first difference model is unique among these four in that it does not share information across the strata on the rate of population change. The population trajectories in each stratum are estimated independently of all other strata.</p>
<p><img src="images/AMKE_firstdiff.png"/></p>
</div>
</div>
<div id="cws-analysis-example" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> CWS analysis example</h2>
<p>The annual CWS analysis uses the heavy-tailed version of the GAMYE model. Here’s the data function call that is used in the 2019 analysis for Scarlet Tanager:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="DataPrep.html#cb11-1" aria-hidden="true" tabindex="-1"></a>jags_data <span class="ot">&lt;-</span> <span class="fu">prepare_jags_data</span>(<span class="at">strat_data =</span> strat_data,</span>
<span id="cb11-2"><a href="DataPrep.html#cb11-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">species_to_run =</span> <span class="st">&quot;Scarlet Tanager&quot;</span>,</span>
<span id="cb11-3"><a href="DataPrep.html#cb11-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">model =</span> <span class="st">&quot;gamye&quot;</span>,</span>
<span id="cb11-4"><a href="DataPrep.html#cb11-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">min_max_route_years =</span> <span class="dv">2</span>,</span>
<span id="cb11-5"><a href="DataPrep.html#cb11-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">heavy_tailed =</span> <span class="cn">TRUE</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="Stratify.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ModelRun.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bbsBayes_Workshop.pdf", "bbsBayes_Workshop.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
